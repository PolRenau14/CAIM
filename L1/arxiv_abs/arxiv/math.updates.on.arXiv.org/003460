In this paper, we relate a beautiful theory by Lov\'asz with a popular heuristic algorithm for the
graph isomorphism problem, namely the color refinement algorithm and its k-dimensional generalization
known as the Weisfeiler-Leman algorithm. We prove that two graphs G and H are indistinguishable
by the color refinement algorithm if and only if, for all trees T, the number Hom(T,G) of homomorphisms
from T to G equals the corresponding number Hom(T,H) for H. There is a natural system of linear equations
whose nonnegative integer solutions correspond to the isomorphisms between two graphs. The nonnegative
real solutions to this system are called fractional isomorphisms, and two graphs are fractionally
isomorphic if and only if the color refinement algorithm cannot distinguish them (Tinhofer 1986,
1991). We show that, if we drop the nonnegativity constraints, that is, if we look for arbitrary real
solutions, then a solution to the linear system exists if and only if, for all t, the two graphs have
the same number of length-t walks. We lift the results for trees to an equivalence between numbers
of homomorphisms from graphs of tree width k, the k-dimensional Weisfeiler-Leman algorithm, and
the level-k Sherali-Adams relaxation of our linear program. We also obtain a partial result for
graphs of bounded path width and solutions to our system where we drop the nonnegativity constraints.
A consequence of our results is a quasi-linear time algorithm to decide whether, for two given graphs
G and H, there is a tree T with Hom(T,G) = Hom(T,H). 